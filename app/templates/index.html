<!DOCTYPE html>
<head>
	<title>地球观察团</title>
	{% import "_macros.html" as macros %}
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/alert.min.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/nav.css') }}"/>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/pagination.min.css') }}">
	<link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.css" />
	<link rel="stylesheet" href="{{ url_for('static', filename='css/_post.css') }}"/>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}"/>

	{{ moment.include_jquery() }}
	{{ moment.include_moment() }}
</head>

<body>
{% include '_nav.html' %}
	{% for message in get_flashed_messages() %}
	<div class="alert alert-warning">
		<a class="close" data-dismiss="alert">&times;</a>
		{{ message }}
	</div>
	{% endfor %}
<section>
<div id="mapid"></div>
<div id="container">
	<ul class="posts">
    {% for post in posts %}
		{% include '_post.html' %}
    {% endfor %}
		{% if pagination %}
		<div class="pagination">
    	{{ macros.pagination_widget(pagination, '.index') }}
		</div>
	{% endif %}
	</ul>
</div>
</section>

<script type="text/javascript" src="{{ url_for('static', filename='js/jquery-2.2.4.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/alert.min.js') }}"></script>
<script src="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	var mymap = L.map('mapid').setView([39.90, 116.40], 3);
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
		'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
		'Imagery © <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

	{% for post in all_posts %}
		var lat = {{ post.lat }};
		var long = {{ post.long }};
		L.marker([lat, long])
				.addTo(mymap)
				.bindPopup('<a href="/post/{{ post.id }}">{{ post.title }}<img class="pop-img" src="../{{ post.photo }}"></a>')
				.openPopup();
	{% endfor %}

	var popup = L.popup();

	function onMapClick(e) {
		popup
				.setLatLng(e.latlng)
				.setContent("坐标 ( " + Math.round(e.latlng.lat * 100) / 100 + ", " + Math.round(e.latlng.lng * 100) / 100 + " )")
				.openOn(mymap);
	}
	mymap.on('click', onMapClick);
});
</script>

</body>
</html>